<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ITX SHOP MEER - Premium Horology & Artisan Collection</title>
    
    <!-- FIXED TikTok Pixel - Won't crash site -->
    <script>
    // Safe TikTok Pixel that won't block rendering
    (function() {
      // Create dummy ttq object immediately so other scripts don't break
      window.ttq = window.ttq || {
        track: function() { 
          if (console && console.log) console.log('[TikTok Pixel] track called'); 
        },
        page: function() { 
          if (console && console.log) console.log('[TikTok Pixel] page called'); 
        }
      };
      
      // Load actual pixel async without blocking
      setTimeout(function() {
        try {
          !function (w, d, t) {
            w.TiktokAnalyticsObject = t;
            var ttq = w[t] = w[t] || [];
            ttq.methods = ["page", "track", "identify", "instances", "debug", "on", "off", "once", "ready", "alias", "group", "enableCookie", "disableCookie"];
            
            // Fixed: Proper setAndDefer function
            ttq.setAndDefer = function(t, e) {
              t[e] = function() {
                t.push([e].concat(Array.prototype.slice.call(arguments, 0)));
              };
            };
            
            for (var e = 0; e < ttq.methods.length; e++) {
              ttq.setAndDefer(ttq, ttq.methods[e]);
            }
            
            ttq.load = function(e, n) {
              var i = "https://analytics.tiktok.com/i18n/pixel/events.js";
              ttq._i = ttq._i || {};
              ttq._i[e] = [];
              ttq._i[e]._u = i;
              
              var o = document.createElement("script");
              o.type = "text/javascript";
              o.async = !0;
              o.src = i + "?sdkid=" + e + "&lib=" + t;
              var a = document.getElementsByTagName("script")[0];
              a.parentNode.insertBefore(o, a);
            };
            
            // YOUR PIXEL ID HERE - replace with your actual ID
            ttq.load('YOUR_PIXEL_ID_HERE');
            ttq.page();
          }(window, document, 'ttq');
          
          console.log('TikTok Pixel loaded');
        } catch (error) {
          console.warn('TikTok Pixel failed to load:', error);
          // Keep dummy object if real one fails
        }
      }, 100); // Load after 100ms - won't block rendering
    })();
    </script>
    <!-- End TikTok Pixel Base Code -->

    <!-- FIXED: Production Tailwind CSS -->
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    
    <!-- Supabase Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
      body { font-family: 'Inter', sans-serif; }
      .font-serif { font-family: 'Playfair Display', serif; }
      .tracking-tightest { letter-spacing: -0.05em; }
      .custom-scrollbar::-webkit-scrollbar { width: 4px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      .animate-fadeIn { animation: fadeIn 0.6s ease-out forwards; }
    </style>
    
    <!-- Your React app import maps -->
    <script type="importmap">
    {
      "imports": {
        "react-router-dom": "https://esm.sh/react-router-dom@^7.13.0",
        "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
        "react/": "https://esm.sh/react@^19.2.4/",
        "react": "https://esm.sh/react@^19.2.4",
        "recharts": "https://esm.sh/recharts@^3.7.0"
      }
    }
    </script>
    
    <!-- Supabase Configuration -->
    <script>
    // Supabase setup - add this before closing head
    const SUPABASE_CONFIG = {
      url: 'https://hwkotlfmxuczloonjziz.supabase.co',
      key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3a290bGZteHVjemxvb25qeml6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkyMzE5ODUsImV4cCI6MjA4NDgwNzk4NX0.GUFuxE-xMBy4WawTWbiyCOWr3lcqNF7BoqQ55-UMe3Y'
    };
    
    // Initialize Supabase
    let supabaseClient = null;
    try {
      supabaseClient = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
      console.log('Supabase initialized');
    } catch (error) {
      console.error('Supabase init error:', error);
    }
    
    // Product deletion fix
    window.deleteProductSafe = async function(productId) {
      if (!supabaseClient) {
        console.error('Supabase not initialized');
        return false;
      }
      
      try {
        const { error } = await supabaseClient
          .from('products')
          .delete()
          .eq('id', productId);
        
        if (error) throw error;
        return true;
      } catch (error) {
        console.error('Delete product error:', error);
        return false;
      }
    };
    </script>
</head>
  <body class="bg-white text-gray-900 selection:bg-black selection:text-white">
    <div id="root"></div>
    
    <!-- Error boundary script -->
    <script>
    // Prevent blank page on errors
    window.addEventListener('error', function(e) {
      console.error('Error caught:', e.error);
      // Don't prevent default to allow page to continue
    });
    
    // Show something if React fails to load
    setTimeout(function() {
      const root = document.getElementById('root');
      if (root && root.innerHTML === '') {
        // Show loading or fallback after 3 seconds
        root.innerHTML = `
          <div style="text-align: center; padding: 50px;">
            <div style="margin-bottom: 20px;">
              <i class="fas fa-spinner fa-spin" style="font-size: 40px; color: #666;"></i>
            </div>
            <h2 style="font-size: 24px; margin-bottom: 10px;">ITX SHOP MEER</h2>
            <p style="color: #666; margin-bottom: 20px;">Loading premium collection...</p>
            <button onclick="location.reload()" style="background: black; color: white; padding: 10px 20px; border: none; border-radius: 5px;">
              Reload Page
            </button>
          </div>
        `;
      }
    }, 3000);
    </script>
  </body>
</html>
